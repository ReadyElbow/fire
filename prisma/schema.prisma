generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "darwin-arm64"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Accounts {
  id                  Int                @id @default(autoincrement())
  provider            String
  bankAccountNumber   Int
  bankAccountSortCode String
  bankAccountType     String
  interestRate        Float
  balance             Float
  updatedAt           DateTime           @updatedAt
  active              Boolean            @default(true)
  transactions        BankTransactions[]
  savingsBudget       SavingsBudget[]
}

model BankTransactions {
  id                      Int                    @id @default(autoincrement())
  transactionDate         DateTime
  description             String
  notes                   String
  amount                  Float
  balanceAfterTransaction Float
  accountID               Int
  account                 Accounts               @relation(fields: [accountID], references: [id])
  transactionCategory     TransactionCategories?
}

model TransactionCategories {
  id             Int              @id @default(autoincrement())
  budgetCategory String
  date           DateTime
  budget         BudgetCategories    @relation(fields: [budgetCategory, date], references: [budgetCategory, date])
  transaction    BankTransactions @relation(fields: [id], references: [id])
}

model JobHistory {
  jobTitle  String
  employer  String
  activeJob Boolean   @default(true)
  startDate DateTime
  endDate   DateTime?
  salary    Float

  @@id([jobTitle, employer])
}

model Debts {
  name         String       @id
  type         String
  description  DateTime
  interestRate Float
  amountOwed   Float
  dueDate      DateTime
  budget       DebtBudget[]
}

model BudgetedAmount {
  date          DateTime @id
  monthlyBudget Float
}

model BudgetCategories {
  date                DateTime
  budgetCategory      String
  monthlyAmount       Float // Either the monthly contribution (savings/debt) or the monthly budget (expenses)
  notes               String
  savingsBudget       SavingsBudget?
  debtBudget          DebtBudget?
  mappedTransactions  TransactionCategories[]
  @@id([date, budgetCategory])
}

model DebtBudget {
  date      DateTime
  debtName  String
  debts     Debts     @relation(fields: [debtName], references: [name])
  budgetCategories  BudgetCategories @relation(fields: [date, debtName], references: [date, budgetCategory])
  @@id([date, debtName])
}

model SavingsBudget {
  date           DateTime
  budgetCategory String
  accountID      Int
  accounts       Accounts      @relation(fields: [accountID], references: [id])
  expenseBudget  BudgetCategories @relation(fields: [date, budgetCategory], references: [date, budgetCategory])
  @@id([date, budgetCategory])
}
